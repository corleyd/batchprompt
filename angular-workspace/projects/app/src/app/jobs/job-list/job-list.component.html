<div class="job-list-container">
  <div class="job-list-header">
    <h1>Jobs</h1>
    <button class="new-job-btn" (click)="createNewJob()">Create New Job</button>
  </div>

  <div class="loading-container" *ngIf="loading">
    <div class="spinner"></div>
    <p>Loading jobs...</p>
  </div>

  <div class="error-message" *ngIf="error">
    <p>Failed to load jobs. Please try again.</p>
    <button (click)="refreshJobs()" class="refresh-btn">Retry</button>
  </div>

  <div class="empty-state" *ngIf="!loading && !error && jobs.length === 0">
    <p>You don't have any jobs yet.</p>
    <button (click)="createNewJob()" class="create-job-btn">Create Your First Job</button>
  </div>

  <div class="jobs-table-container" *ngIf="!loading && !error && jobs.length > 0">
    <table class="jobs-table">
      <thead>
        <tr>
          <th (click)="updateSort('fileName')" class="sortable-header">
            File Name
            <span class="sort-icon" *ngIf="sortField === 'fileName'">
              {{ sortDirection === 'asc' ? '↑' : '↓' }}
            </span>
          </th>
          <th (click)="updateSort('promptName')" class="sortable-header">
            Prompt
            <span class="sort-icon" *ngIf="sortField === 'promptName'">
              {{ sortDirection === 'asc' ? '↑' : '↓' }}
            </span>
          </th>
          <th (click)="updateSort('modelName')" class="sortable-header">
            Model
            <span class="sort-icon" *ngIf="sortField === 'modelName'">
              {{ sortDirection === 'asc' ? '↑' : '↓' }}
            </span>
          </th>
          <th (click)="updateSort('status')" class="sortable-header">
            Status
            <span class="sort-icon" *ngIf="sortField === 'status'">
              {{ sortDirection === 'asc' ? '↑' : '↓' }}
            </span>
          </th>
          <th (click)="updateSort('createdAt')" class="sortable-header">
            Created
            <span class="sort-icon" *ngIf="sortField === 'createdAt'">
              {{ sortDirection === 'asc' ? '↑' : '↓' }}
            </span>
          </th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let job of jobs">
          <td>{{ job.fileName }}</td>
          <td>{{ job.promptName }}</td>
          <td>{{ job.modelName }}</td>
          <td>
            <span class="status-badge" [ngClass]="getStatusClass(job.status)">
              {{ job.status }}
              <ng-container *ngIf="job.status === 'PROCESSING'">
                ({{ job.completedTaskCount }}/{{ job.taskCount }})
              </ng-container>
            </span>
          </td>
          <td>{{ job.createdAt | date:'medium' }}</td>
          <td class="job-actions">
            <app-download-button 
              *ngIf="job.status === 'COMPLETED' && job.resultFileUuid"
              [fileUuid]="job.resultFileUuid"
              [fileName]="'Results_' + job.jobUuid + '.xlsx'"
              [buttonText]="'Download Results'"
            ></app-download-button>
            <button *ngIf="job.status === 'COMPLETED' && !job.resultFileUuid" class="view-results-btn">View Results</button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="pagination-controls" *ngIf="!loading && !error && totalPages > 0">
    <div class="page-info">
      Showing {{ jobs.length ? (currentPage * pageSize) + 1 : 0 }} - {{ (currentPage * pageSize) + jobs.length }} of {{ totalItems }} jobs
    </div>
    
    <div class="page-navigation">
      <button 
        class="page-button" 
        [disabled]="currentPage === 0" 
        (click)="previousPage()"
      >
        Previous
      </button>

      <div class="page-numbers">
        <button 
          *ngFor="let page of [].constructor(totalPages < 5 ? totalPages : 5); let i = index"
          class="page-number" 
          [class.active]="(currentPage < 2 ? i : currentPage - 2 + i) === currentPage"
          (click)="goToPage(currentPage < 2 ? i : currentPage - 2 + i)"
          [disabled]="(currentPage < 2 ? i : currentPage - 2 + i) >= totalPages"
        >
          {{ (currentPage < 2 ? i : currentPage - 2 + i) + 1 }}
        </button>
      </div>

      <button 
        class="page-button" 
        [disabled]="currentPage >= totalPages - 1" 
        (click)="nextPage()"
      >
        Next
      </button>
    </div>
    
    <div class="page-size-selector">
      <label for="pageSize">Items per page:</label>
      <select id="pageSize" [(ngModel)]="pageSize" (change)="currentPage = 0; loadJobs()">
        <option [value]="5">5</option>
        <option [value]="10">10</option>
        <option [value]="20">20</option>
        <option [value]="50">50</option>
      </select>
    </div>
  </div>

  <div class="list-actions" *ngIf="!loading && !error && jobs.length > 0">
    <button (click)="refreshJobs()" class="refresh-btn">Refresh Jobs</button>
  </div>
</div>
